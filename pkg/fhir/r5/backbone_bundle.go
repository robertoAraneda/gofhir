// Code generated by gofhir. DO NOT EDIT.
// Source: FHIR StructureDefinitions (backbone elements)
// Package: r5

package r5

import (
	"encoding/json"
	"fmt"
)

// BundleEntry represents the Bundle.entry backbone element.
// Entry in the bundle - will have a resource or information
type BundleEntry struct {
	// Unique id for inter-element referencing
	Id *string `json:"id,omitempty"`
	// Additional content defined by implementations
	Extension []Extension `json:"extension,omitempty"`
	// Extensions that cannot be ignored even if unrecognized
	ModifierExtension []Extension `json:"modifierExtension,omitempty"`
	// Links related to this entry
	Link []BundleLink `json:"link,omitempty"`
	// URI for resource (e.g. the absolute URL server address, URI for UUID/OID, etc.)
	FullUrl *string `json:"fullUrl,omitempty"`
	// A resource in the bundle
	Resource Resource `json:"resource,omitempty"`
	// Search related information
	Search *BundleEntrySearch `json:"search,omitempty"`
	// Additional execution information (transaction/batch/history)
	Request *BundleEntryRequest `json:"request,omitempty"`
	// Results of execution (transaction/batch/history)
	Response *BundleEntryResponse `json:"response,omitempty"`
}

// UnmarshalJSON handles deserialization of polymorphic resource field.
func (b *BundleEntry) UnmarshalJSON(data []byte) error {
	// Use an alias to avoid infinite recursion
	type Alias BundleEntry
	aux := &struct {
		Resource json.RawMessage `json:"resource,omitempty"`
		*Alias
	}{
		Alias: (*Alias)(b),
	}

	if err := json.Unmarshal(data, aux); err != nil {
		return err
	}

	// Unmarshal the resource field using the dispatcher
	if len(aux.Resource) > 0 {
		resource, err := UnmarshalResource(aux.Resource)
		if err != nil {
			return fmt.Errorf("failed to unmarshal resource: %w", err)
		}
		b.Resource = resource
	}

	return nil
}

// BundleEntryRequest represents the Bundle.entry.request backbone element.
// Additional execution information (transaction/batch/history)
type BundleEntryRequest struct {
	// Unique id for inter-element referencing
	Id *string `json:"id,omitempty"`
	// Additional content defined by implementations
	Extension []Extension `json:"extension,omitempty"`
	// Extensions that cannot be ignored even if unrecognized
	ModifierExtension []Extension `json:"modifierExtension,omitempty"`
	// GET | HEAD | POST | PUT | DELETE | PATCH
	Method *HTTPVerb `json:"method,omitempty"`
	// URL for HTTP equivalent of this entry
	Url *string `json:"url,omitempty"`
	// For managing cache validation
	IfNoneMatch *string `json:"ifNoneMatch,omitempty"`
	// For managing cache currency
	IfModifiedSince *string `json:"ifModifiedSince,omitempty"`
	// For managing update contention
	IfMatch *string `json:"ifMatch,omitempty"`
	// For conditional creates
	IfNoneExist *string `json:"ifNoneExist,omitempty"`
}

// BundleEntryResponse represents the Bundle.entry.response backbone element.
// Results of execution (transaction/batch/history)
type BundleEntryResponse struct {
	// Unique id for inter-element referencing
	Id *string `json:"id,omitempty"`
	// Additional content defined by implementations
	Extension []Extension `json:"extension,omitempty"`
	// Extensions that cannot be ignored even if unrecognized
	ModifierExtension []Extension `json:"modifierExtension,omitempty"`
	// Status response code (text optional)
	Status *string `json:"status,omitempty"`
	// The location (if the operation returns a location)
	Location *string `json:"location,omitempty"`
	// The Etag for the resource (if relevant)
	Etag *string `json:"etag,omitempty"`
	// Server's date time modified
	LastModified *string `json:"lastModified,omitempty"`
	// OperationOutcome with hints and warnings (for batch/transaction)
	Outcome Resource `json:"outcome,omitempty"`
}

// UnmarshalJSON handles deserialization of polymorphic resource field.
func (b *BundleEntryResponse) UnmarshalJSON(data []byte) error {
	// Use an alias to avoid infinite recursion
	type Alias BundleEntryResponse
	aux := &struct {
		Outcome json.RawMessage `json:"outcome,omitempty"`
		*Alias
	}{
		Alias: (*Alias)(b),
	}

	if err := json.Unmarshal(data, aux); err != nil {
		return err
	}

	// Unmarshal the resource field using the dispatcher
	if len(aux.Outcome) > 0 {
		resource, err := UnmarshalResource(aux.Outcome)
		if err != nil {
			return fmt.Errorf("failed to unmarshal outcome: %w", err)
		}
		b.Outcome = resource
	}

	return nil
}

// BundleEntrySearch represents the Bundle.entry.search backbone element.
// Search related information
type BundleEntrySearch struct {
	// Unique id for inter-element referencing
	Id *string `json:"id,omitempty"`
	// Additional content defined by implementations
	Extension []Extension `json:"extension,omitempty"`
	// Extensions that cannot be ignored even if unrecognized
	ModifierExtension []Extension `json:"modifierExtension,omitempty"`
	// match | include - why this is in the result set
	Mode *SearchEntryMode `json:"mode,omitempty"`
	// Search ranking (between 0 and 1)
	Score *float64 `json:"score,omitempty"`
}

// BundleLink represents the Bundle.link backbone element.
// Links related to this Bundle
type BundleLink struct {
	// Unique id for inter-element referencing
	Id *string `json:"id,omitempty"`
	// Additional content defined by implementations
	Extension []Extension `json:"extension,omitempty"`
	// Extensions that cannot be ignored even if unrecognized
	ModifierExtension []Extension `json:"modifierExtension,omitempty"`
	// See http://www.iana.org/assignments/link-relations/link-relations.xhtml#link-relations-1
	Relation *string `json:"relation,omitempty"`
	// Reference details for the link
	Url *string `json:"url,omitempty"`
}
